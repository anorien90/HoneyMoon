<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HoneyMoon</title>
  <!-- Tailwind: dev CDN. For production, bundle/compile Tailwind. -->
  <script src="https://cdn.tailwindcss.com" defer></script>

  <!-- Leaflet (kept as original CDN) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="" defer></script>

  <!-- App styles -->
  <link rel="stylesheet" href="./static/styles.css" />
</head>
<body class="min-h-screen">

  <!-- Top header / compact toolbar -->
  <div class="w-full max-w-7xl mx-auto mb-4 flex items-center justify-between gap-4">
    <div class="flex items-center gap-4">
      <div class="p-3 flex items-center gap-3">
        <img src="/static/media/LogoPlain.png" class="main-logo" alt="HoneyMoon Logo" />
        <img src="/static/media/Banner.png" class="main-logo" alt="HoneyMoon Banner" />
      </div>

      <!-- TAB BAR -->
      <div class="card toolbar">
        <div class="flex gap-1" role="tablist" aria-label="Main sections">
          <button data-tab-btn="explore" class="tab-btn tab-active small px-3 py-1 rounded" aria-selected="true">Explore</button>
          <button data-tab-btn="honeypot" class="tab-btn small px-3 py-1 rounded" aria-selected="false">Honeypot</button>
        </div>

        <div class="ml-4 pill" role="group" aria-label="IP controls">
          <label for="ipInput" class="sr-only">Target IP</label>
          <input id="ipInput" type="text" placeholder="e.g. 8.8.8.8" class="border-none bg-transparent focus:outline-none" aria-label="IP address" />
          <button id="locateBtn" class="action" title="Locate (L)" aria-label="Locate IP">Locate</button>
          <button id="traceBtn" class="action" title="Trace (T)" aria-label="Trace route to IP">Trace</button>
          <label class="small muted" for="deepToggle">Deep</label>
          <input id="deepToggle" type="checkbox" class="ml-1" aria-label="Enable deep tracing" />
          <input id="maxttl" type="number" value="30" min="1" max="128" class="ml-1 w-16 border rounded px-2 py-1" aria-label="Maximum TTL" />
          <label class="small muted ml-3" for="maxttl">Max TTL</label>
        </div>
      </div>
    </div>

    <div class="flex items-center gap-3">
      <div class="card toolbar p-2 flex items-center gap-2">
        <button id="toggleLeft" class="border rounded px-2 py-1 small" title="Toggle left sidebar" aria-pressed="false" aria-label="Toggle left sidebar">â˜°</button>
        <button id="toggleRight" class="border rounded px-2 py-1 small" title="Toggle right sidebar" aria-pressed="false" aria-label="Toggle right sidebar">â–¤</button>
        <button id="themeToggle" class="border rounded px-2 py-1 small" title="Toggle theme" aria-label="Toggle theme">ðŸŒ™</button>
        <button id="closeAllPinsBtn" class="border rounded px-2 py-1 small" title="Close all pinned cards" aria-label="Close all pinned cards">Close pins</button>
        <button id="toggleLayoutBtn" class="border rounded px-2 py-1 small" title="Toggle layout" aria-label="Toggle layout">Free</button>
      </div>
    </div>
  </div>

  <!-- Main pinned workspace -->
  <div id="pinnedArea" class="pinned-area workspace" aria-label="Workspace for movable panels"></div>

  <!-- Original layout (kept for source content; panels will be floated into workspace on load) -->
  <div class="w-full max-w-7xl mx-auto grid grid-cols-12 gap-6">

    <!-- LEFT column (controls) -->
    <aside id="leftSidebar" class="col-span-12 lg:col-span-4 sidebar-section space-y-4">

      <!-- EXPLORE PANEL (advanced DB only) -->
      <div id="panel-explore" class="tab-panel">
        <div class="card p-4 card-collapsible" id="exploreCard">
          <div class="card-header flex items-center justify-between">
            <div>
              <h2 class="text-lg font-semibold">Explore / Database</h2>
            </div>
            <div class="flex gap-2 items-center">
              <button class="card-toggle small border rounded px-2 py-1" title="Collapse card" aria-label="Collapse explore card">â–¾</button>
            </div>
          </div>

          <div class="card-body mt-3">
            <hr class="my-3"/>

            <!-- advanced DB panel embedded -->
            <div id="dbResultsDatabase" class="text-sm muted mt-3 small compact-scroll">
              <!-- db-ui will populate -->
            </div>

            <hr class="my-3"/>

            <div class="mt-2">
              <h3 class="text-sm font-medium">Recent searches</h3>
              <div id="searchHistory" class="mt-2 small muted"></div>
            </div>
          </div>
        </div>

      </div>

      <!-- HONEYPOT quick controls -->
      <div id="panel-honeypot-left" class="">
        <div class="card p-4 card-collapsible" id="honeypotCard">
          <div class="card-header flex items-center justify-between">
            <div>
              <h2 class="text-lg font-semibold">Honeypot</h2>
              <div class="small muted">Sessions & ingest controls</div>
            </div>
            <div>
              <button class="card-toggle small border rounded px-2 py-1" title="Collapse card" aria-label="Collapse honeypot card">â–¾</button>
            </div>
          </div>

          <div class="card-body mt-3">
            <div class="mt-3 space-y-2">
              <div class="flex gap-2 items-center">
                <input id="honeypotFilter" type="text" placeholder="Filter by src_ip or username" class="flex-1 border rounded px-2 py-1 small" aria-label="Filter honeypot sessions" />
                <button id="honeypotListBtn" class="border rounded px-2 py-1 small" aria-label="List honeypot sessions">List</button>
                <button id="honeypotFlowsBtn" class="border rounded px-2 py-1 small" aria-label="List honeypot flows">Flows</button>
              </div>

              <div id="honeypotSessionsList" class="mt-2 small muted compact-scroll max-h-40">
                (click "List")
              </div>

              <div class="mt-3">
                <div class="text-xs muted">Get artifact</div>
                <div class="mt-1 flex gap-2">
                  <input id="honeypotArtifactName" type="text" placeholder="artifact_filename" class="flex-1 border rounded px-2 py-1 small" aria-label="Artifact name" />
                  <button id="honeypotArtifactBtn" class="border rounded px-3 py-1 small" aria-label="Download artifact">Download</button>
                </div>
              </div>

              <div class="mt-3 text-xs muted">Ingest Cowrie JSON</div>
              <div class="mt-1 flex gap-2">
                <input id="honeypotIngestPath" type="text" placeholder="/data/honeypot/cowrie.json" class="flex-1 border rounded px-2 py-1 small" aria-label="Cowrie JSON path" />
                <button id="honeypotIngestBtn" class="border rounded px-3 py-1 small bg-emerald-600 text-white" aria-label="Ingest Cowrie data">Ingest</button>
              </div>
              <div id="honeypotIngestStatus" class="mt-1 small muted"></div>

              <div class="mt-3 text-xs muted">Ingest PCAP</div>
              <div class="mt-1 flex gap-2">
                <input id="pcapPath" type="text" placeholder="/data/honeypot/capture.pcap" class="flex-1 border rounded px-2 py-1 small" aria-label="PCAP file path" />
              </div>
              <div class="mt-1 flex gap-2">
                <input id="pcapFilterHost" type="text" placeholder="filter_host (optional)" class="flex-1 border rounded px-2 py-1 small" aria-label="PCAP filter host" />
                <button id="honeypotIngestPcapBtn" class="border rounded px-3 py-1 small bg-amber-600 text-white" aria-label="Ingest PCAP">Ingest PCAP</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </aside>

    <!-- CENTER column: map / main content -->
    <main class="col-span-12 lg:col-span-4">
      <div class="card p-3 card-collapsible" id="mapCard">
        <div class="card-header flex items-center justify-between">
          <div>
            <h2 class="text-lg font-semibold">Map</h2>
            <div class="small muted">Interactive traceroute map</div>
          </div>
          <div class="flex gap-2 items-center">
            <button id="toggleMapCard" class="small border rounded px-2 py-1" title="Collapse map" aria-label="Collapse map card">â–¾</button>
          </div>
        </div>

        <div class="card-body mt-3">
          <div id="map" class="mb-2" aria-hidden="false" role="img" aria-label="Interactive map of IP locations"></div>

          <div class="flex items-center justify-between mt-2">
            <div class="flex items-center gap-3">
              <div id="loading" class="hidden items-center gap-2 small muted">
                <span class="spin" role="status" aria-hidden="true"></span>
                <span>Workingâ€¦</span>
              </div>
              <div id="status" class="small muted">Ready</div>
              <div id="sessionSummary" class="small muted ml-4"></div>
            </div>
            <div class="small muted">Markers: <span id="markerCount">0</span></div>
          </div>

          <div class="mt-3 flex gap-2 justify-end">
            <button id="refreshOrgBtn" class="bg-yellow-500 text-white rounded px-3 py-2 small" aria-label="Refresh organization info">Refresh Org Info</button>
            <button id="fitMarkersBtn" class="border rounded px-3 py-2 small" aria-label="Fit map to markers">Fit</button>
            <button id="clearMapBtn" class="border rounded px-3 py-2 small" aria-label="Clear map">Clear</button>
          </div>
        </div>
      </div>
    </main>

    <!-- RIGHT column: details & pins -->
    <aside id="rightSidebar" class="col-span-12 lg:col-span-4 space-y-4 sidebar-section">
      <div class="card p-4 card-collapsible" id="selectedNodeCard">
        <div class="card-header flex items-center justify-between">
          <div>
            <h3 class="text-lg font-semibold">Selected Node / Org</h3>
            <div class="small muted">Details about selected map marker</div>
          </div>
          <div>
            <button class="card-toggle small border rounded px-2 py-1" title="Collapse selected node card" aria-label="Collapse selected node card">â–¾</button>
          </div>
        </div>
        <div class="card-body mt-3">
          <div id="selectedInfo" class="text-sm muted space-y-1 mt-3 small">
            <div class="flex items-center gap-2"><strong>IP:</strong> <span id="selIp">â€”</span> <button id="copyIpBtn" title="Copy IP" aria-label="Copy selected IP">Copy</button></div>
            <div><strong>Hostname:</strong> <span id="selHost">â€”</span></div>
            <div><strong>Organization:</strong> <span id="selOrg">â€”</span></div>
            <div><strong>Registry:</strong> <span id="selRegistry">â€”</span></div>
            <div><strong>ASN / ISP:</strong> <span id="selASN">â€”</span></div>
            <div><strong>Country / City:</strong> <span id="selCC">â€”</span></div>
            <div><strong>First Seen:</strong> <span id="selFirst">â€”</span></div>
            <div><strong>Last Seen:</strong> <span id="selLast">â€”</span></div>
            <div><strong>Seen Count:</strong> <span id="selCount">â€”</span></div>
          </div>
        </div>
      </div>

      <div class="card p-4 card-collapsible" id="hopCard">
        <div class="card-header flex items-center justify-between">
          <div>
            <h3 class="text-lg font-semibold">Traceroute Hops</h3>
          </div>
          <div>
            <button class="card-toggle small border rounded px-2 py-1" title="Collapse hops card" aria-label="Collapse hops card">â–¾</button>
          </div>
        </div>
        <div class="card-body mt-3">
          <div id="hopList" class="text-sm muted max-h-64 overflow-auto mt-3 small compact-scroll">
            No traces yet.
          </div>
        </div>
      </div>
    </aside>
  </div>

  <!-- modal container -->
  <div id="modalContainer" class="modal-hidden" aria-hidden="true"></div>

  <!-- toast container -->
  <div id="toast" aria-live="polite"></div>

  <!-- App script (ES module) -->
  <script type="module" src="./static/app.js"></script>
</body>
</html>

