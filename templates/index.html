<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HoneyMoon</title>
  
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="" defer></script>
  
  <!-- App styles -->
  <link rel="stylesheet" href="./static/styles.css" />
  <link rel="stylesheet" href="./static/pannel-system.css" />
</head>
<body>
  <div class="app-container">
    
    <!-- Header -->
    <header class="app-header">
      <div class="logo">
        <img src="/static/media/LogoPlain.png" alt="HoneyMoon Logo" />
        <img src="/static/media/Banner.png" alt="HoneyMoon" />
      </div>
      
      <div class="toolbar">
        <!-- Tabs -->
        <div class="tabs" role="tablist">
          <button class="tab-btn active" data-tab="explore" role="tab" aria-selected="true">Explore</button>
          <button class="tab-btn" data-tab="honeypot" role="tab" aria-selected="false">Honeypot</button>
          <button class="tab-btn" data-tab="agents" role="tab" aria-selected="false">Agents</button>
          <button class="tab-btn" data-tab="analysis" role="tab" aria-selected="false">Analysis</button>
          <button class="tab-btn" data-tab="reports" role="tab" aria-selected="false">Reports</button>
        </div>
        
        <!-- IP controls -->
        <div class="toolbar-group">
          <input id="ipInput" type="text" placeholder="IP address" aria-label="Target IP" style="width: 140px" />
          <button id="locateBtn" class="primary" title="Locate (L)">Locate</button>
          <button id="traceBtn" title="Trace (T)">Trace</button>
        </div>
        
        <div class="toolbar-group">
          <label class="small">
            <input id="deepToggle" type="checkbox" /> Deep
          </label>
          <input id="maxttl" type="number" value="30" min="1" max="128" style="width: 50px" aria-label="Max TTL" />
          <span class="small muted">TTL</span>
        </div>
      </div>
      
      <div class="toolbar">
        <button id="addPanelBtn" title="Add panel">+ Panel</button>
        <button id="toggleLayoutBtn" title="Toggle layout mode">Free</button>
        <button id="toggleLeft" title="Toggle left sidebar">â—€</button>
        <button id="toggleMiddle" title="Toggle middle overlay zone">â—</button>
        <button id="toggleRight" title="Toggle right sidebar">â–¶</button>
        <button id="themeToggle" title="Toggle theme">ğŸŒ™</button>
        <button id="closeAllPinsBtn" title="Close all pinned cards">Close pins</button>
        <button id="systemStatusBtn" title="System status" style="background: var(--accent); color: white;">Status</button>
      </div>
    </header>
    
    <!-- Main content -->
    <main class="app-main">
      <!-- Left zone -->
      <div id="leftZone" class="zone" aria-label="Left sidebar"></div>
      
      <!-- Main zone -->
      <div id="mainZone" class="zone" aria-label="Main content area"></div>
      
      <!-- Right zone -->
      <div id="rightZone" class="zone" aria-label="Right sidebar"></div>
    </main>
    
    <!-- Pinned workspace with collapsible header -->
    <div id="pinnedAreaContainer" class="pinned-area-container">
      <div class="pinned-area-header" id="pinnedAreaHeader">
        <div class="pinned-area-title">
          <span>ğŸ“Œ</span>
          <span>Pinned Cards</span>
          <span id="pinnedCardCount" class="small muted">(0)</span>
        </div>
        <div class="pinned-area-controls">
          <button id="togglePinnedArea" title="Collapse/Expand" aria-label="Toggle pinned area">â–¾</button>
        </div>
      </div>
      <div id="pinnedArea" class="pinned-area workspace" aria-label="Workspace for pinned/floating panels"></div>
    </div>
    
  </div>
  
  <!-- Source panels (will be moved to zones by JS) -->
  <div id="sourcePanels" style="display: none;">
    
    <!-- Map panel -->
    <div id="mapCard" class="card">
      <div class="card-header">
        <h2>Map</h2>
      </div>
      <div class="card-body">
        <div id="map"></div>
        <div class="map-footer" style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.5rem;">
          <div style="display: flex; align-items: center; gap: 1rem;">
            <div id="loading" class="hidden"><span class="spinner"></span><span class="small muted">Workingâ€¦</span></div>
            <div id="status" class="small muted">Ready</div>
            <div id="sessionSummary" class="small muted"></div>
          </div>
          <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
            <!-- Live view controls -->
            <button id="liveToggleBtn" class="small live-toggle" title="Toggle live view">âšª Live</button>
            <div id="liveControls" class="hidden" style="display: flex; gap: 0.25rem; align-items: center;">
              <input id="liveMinutes" type="number" value="15" min="1" max="1440" style="width: 50px;" title="Time window in minutes" aria-label="Live view time window in minutes" />
              <span class="small muted">min</span>
              <label class="small" style="display: flex; align-items: center; gap: 0.25rem;" title="Show outgoing connections from this system">
                <input id="liveOutgoingToggle" type="checkbox" /> Outgoing
              </label>
              <button id="liveRefreshBtn" class="small" title="Refresh live data">â†»</button>
              <span class="small muted">(<span id="liveCount">0</span>)</span>
              <span id="liveStatus" class="small muted"></span>
            </div>
            <span class="live-divider" style="border-left: 1px solid var(--border); height: 16px; margin: 0 0.25rem;"></span>
            <!-- Layer toggle controls -->
            <div id="layerToggles" style="display: flex; gap: 0.25rem; align-items: center;">
              <span class="small muted">Layers:</span>
              <label class="small" style="display: flex; align-items: center; gap: 0.15rem;" title="Toggle attacker markers (red)">
                <input id="toggleAttackers" type="checkbox" checked /> <span style="color: #dc2626;">â—</span>
              </label>
              <label class="small" style="display: flex; align-items: center; gap: 0.15rem;" title="Toggle outgoing connection markers (green)">
                <input id="toggleOutgoing" type="checkbox" checked /> <span style="color: #10b981;">â—</span>
              </label>
              <label class="small" style="display: flex; align-items: center; gap: 0.15rem;" title="Toggle path lines">
                <input id="togglePaths" type="checkbox" checked /> <span style="color: #ff7b00;">â”€</span>
              </label>
              <label class="small" style="display: flex; align-items: center; gap: 0.15rem;" title="Toggle node markers (orange)">
                <input id="toggleNodes" type="checkbox" checked /> <span style="color: #ff7b00;">â—</span>
              </label>
            </div>
            <span class="live-divider" style="border-left: 1px solid var(--border); height: 16px; margin: 0 0.25rem;"></span>
            <!-- Existing controls -->
            <button id="fitMarkersBtn" class="small">Fit</button>
            <button id="clearMapBtn" class="small">Clear</button>
            <button id="refreshOrgBtn" class="small">Refresh Org</button>
            <button id="accessesBtn" class="small">Accesses</button>
            <span class="small muted">Markers: <span id="markerCount">0</span></span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Explore/Database panel -->
    <div id="exploreCard" class="card">
      <div class="card-header">
        <h2>Database Explorer</h2>
      </div>
      <div class="card-body">
        <div id="dbResultsDatabase"></div>
        <hr style="margin: 1rem 0; border:  none; border-top: 1px solid var(--border);" />
        <div>
          <div class="small muted">Recent searches</div>
          <div id="searchHistory"></div>
        </div>
      </div>
    </div>
    
    <!-- Honeypot panel -->
    <div id="honeypotCard" class="card">
      <div class="card-header">
        <h2>Honeypot</h2>
      </div>
      <div class="card-body">
        <div style="display: flex; gap: 0.5rem; margin-bottom: 0.75rem;">
          <input id="honeypotFilter" type="text" placeholder="Filter by IP or username" style="flex: 1;" />
          <button id="honeypotListBtn">List</button>
          <button id="honeypotFlowsBtn">Flows</button>
        </div>
        
        <!-- AI Quick Actions for Sessions -->
        <div class="ai-actions-panel" style="margin-bottom: 0.75rem; padding: 0.5rem; background: var(--glass); border-radius: var(--radius);">
          <div class="small muted" style="margin-bottom: 0.5rem;">ğŸ¤– AI Quick Actions</div>
          <div style="display: flex; gap: 0.25rem; flex-wrap: wrap;">
            <button id="honeypotAnalyzeSelectedBtn" class="small ai-action-btn" title="Analyze selected session">ğŸ” Analyze</button>
            <button id="honeypotUnifyThreatsBtn" class="small ai-action-btn" title="Unify multiple threats">ğŸ”— Unify</button>
            <button id="honeypotBulkAnalyzeBtn" class="small ai-action-btn" title="Bulk analyze recent sessions">ğŸ“Š Bulk</button>
            <button id="honeypotChatBtn" class="small ai-action-btn" title="Ask AI about honeypot data">ğŸ’¬ Chat</button>
          </div>
        </div>
        
        <div id="honeypotSessionsList" class="compact-scroll small muted">(click List)</div>
        <div id="honeypotFlowsList" class="compact-scroll small muted" style="margin-top: 0.5rem;"></div>
        
        <hr style="margin: 1rem 0; border: none; border-top: 1px solid var(--border);" />
        
        <div class="small muted">Get artifact</div>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
          <input id="honeypotArtifactName" type="text" placeholder="artifact_filename" style="flex: 1;" />
          <button id="honeypotArtifactBtn">Download</button>
        </div>
        
        <hr style="margin: 1rem 0; border: none; border-top: 1px solid var(--border);" />
        
        <div class="small muted">Ingest Cowrie JSON</div>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
          <input id="honeypotIngestPath" type="text" placeholder="/data/honeypot/cowrie.json" style="flex: 1;" />
          <button id="honeypotIngestBtn" style="background: #059669; color: white;">Ingest</button>
        </div>
        
        <div class="small muted" style="margin-top: 0.75rem;">Ingest PCAP</div>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
          <input id="pcapPath" type="text" placeholder="/data/capture. pcap" style="flex: 1;" />
        </div>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
          <input id="pcapFilterHost" type="text" placeholder="filter_host (optional)" style="flex: 1;" />
          <button id="honeypotIngestPcapBtn" style="background: #d97706; color: white;">Ingest PCAP</button>
        </div>
        <div id="honeypotIngestStatus" class="small muted" style="margin-top: 0.5rem;"></div>
      </div>
    </div>
    
    <!-- Selected Node panel -->
    <div id="selectedNodeCard" class="card">
      <div class="card-header">
        <h2>Selected Node</h2>
      </div>
      <div class="card-body">
        <div id="selectedInfo" class="small">
          <div><strong>IP:</strong> <span id="selIp">â€”</span> <button id="copyIpBtn" class="small" style="padding: 2px 6px;">Copy</button></div>
          <div><strong>Hostname:</strong> <span id="selHost">â€”</span></div>
          <div><strong>Organization:</strong> <span id="selOrg">â€”</span></div>
          <div><strong>Registry:</strong> <span id="selRegistry">â€”</span></div>
          <div><strong>ASN / ISP:</strong> <span id="selASN">â€”</span></div>
          <div><strong>Location:</strong> <span id="selCC">â€”</span></div>
          <div><strong>Open Ports:</strong> <span id="selPorts">â€”</span></div>
          <div><strong>OS / Fingerprint:</strong> <span id="selOs">â€”</span></div>
          <div><strong>HTTP/TLS:</strong> <span id="selHttp">â€”</span></div>
          <div><strong>Tags:</strong> <span id="selTags">â€”</span></div>
          <div><strong>First Seen:</strong> <span id="selFirst">â€”</span></div>
          <div><strong>Last Seen:</strong> <span id="selLast">â€”</span></div>
          <div><strong>Seen Count:</strong> <span id="selCount">â€”</span></div>
        </div>
        
        <!-- AI Actions for Selected Node -->
        <div id="selectedNodeActions" class="ai-actions-panel" style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border);">
          <div class="small muted" style="margin-bottom: 0.5rem;">ğŸ¤– AI Actions</div>
          <div style="display: flex; gap: 0.25rem; flex-wrap: wrap;">
            <button id="nodeIntelBtn" class="small ai-action-btn" title="Get AI intelligence report">ğŸ” Intel</button>
            <button id="nodeReportBtn" class="small ai-action-btn" title="Generate formal report">ğŸ“‹ Report</button>
            <button id="nodeSimilarBtn" class="small ai-action-btn" title="Find similar attackers">ğŸ”— Similar</button>
            <button id="nodeChatBtn" class="small ai-action-btn" title="Ask AI about this node">ğŸ’¬ Chat</button>
          </div>
        </div>
        
        <div id="recentAccesses" class="compact-scroll small muted" style="margin-top: 0.75rem;"></div>
      </div>
    </div>
    
    <!-- Hops panel -->
    <div id="hopCard" class="card">
      <div class="card-header">
        <h2>Traceroute Hops</h2>
      </div>
      <div class="card-body">
        <div id="hopList" class="compact-scroll small muted">No traces yet. </div>
      </div>
    </div>
    
    <!-- Agent System panel -->
    <div id="agentCard" class="card">
      <div class="card-header">
        <h2>ğŸ¤– Agent System</h2>
      </div>
      <div class="card-body">
        <div id="agentStatus" class="small muted" style="margin-bottom: 0.75rem;">
          <div><strong>Status:</strong> <span id="agentRunningStatus">Loading...</span></div>
          <div><strong>Workers:</strong> <span id="agentWorkerCount">â€”</span></div>
          <div><strong>Tasks:</strong> <span id="agentTaskCount">â€”</span></div>
        </div>
        
        <div class="small muted">Quick Actions</div>
        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
          <button id="agentInvestigateBtn" class="small" style="background: #3b82f6; color: white;">ğŸ” Investigate IP</button>
          <button id="agentThreatHuntBtn" class="small" style="background: #8b5cf6; color: white;">ğŸ¯ Threat Hunt</button>
          <button id="agentMonitorBtn" class="small" style="background: #10b981; color: white;">ğŸ“¡ Monitor</button>
        </div>
        
        <hr style="margin: 0.75rem 0; border: none; border-top: 1px solid var(--border);" />
        
        <div class="small muted">Task Templates</div>
        <div id="agentTemplatesList" class="compact-scroll small muted" style="max-height: 120px; margin-top: 0.5rem;"></div>
        
        <hr style="margin: 0.75rem 0; border: none; border-top: 1px solid var(--border);" />
        
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <span class="small muted">Active Tasks</span>
          <button id="agentRefreshBtn" class="small">â†» Refresh</button>
        </div>
        <div id="agentTasksList" class="compact-scroll small" style="max-height: 200px; margin-top: 0.5rem;"></div>
        
        <hr style="margin: 0.75rem 0; border: none; border-top: 1px solid var(--border);" />
        
        <div class="small muted">Agent Messages</div>
        <div id="agentMessagesList" class="compact-scroll small muted" style="max-height: 120px; margin-top: 0.5rem;"></div>
      </div>
    </div>
    
    <!-- AI Analysis panel -->
    <div id="analysisCard" class="card">
      <div class="card-header">
        <h2>ğŸ§  AI Analysis</h2>
      </div>
      <div class="card-body">
        <div id="llmStatus" class="small muted" style="margin-bottom: 0.75rem;">
          <div><strong>LLM Status:</strong> <span id="llmAvailableStatus">Loading...</span></div>
          <div><strong>Model:</strong> <span id="llmModelName">â€”</span></div>
          <div><strong>Vector Store:</strong> <span id="vectorStoreStatus">â€”</span></div>
        </div>
        
        <div class="small muted">Session Analysis</div>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
          <input id="analysisSessionId" type="number" placeholder="Session ID" style="flex: 1;" />
          <button id="analyzeSessionBtn" style="background: #3b82f6; color: white;">Analyze</button>
        </div>
        
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
          <button id="formalReportBtn" class="small" style="background: #8b5cf6; color: white;">ğŸ“‹ Formal Report</button>
          <button id="countermeasuresBtn" class="small" style="background: #ef4444; color: white;">ğŸ›¡ï¸ Countermeasures</button>
          <button id="detectionRulesBtn" class="small" style="background: #f59e0b; color: white;">ğŸ“œ Detection Rules</button>
        </div>
        
        <hr style="margin: 0.75rem 0; border: none; border-top: 1px solid var(--border);" />
        
        <div class="small muted">Similarity Search</div>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
          <input id="similarityQuery" type="text" placeholder="Search query or IP" style="flex: 1;" />
          <button id="searchSimilarBtn" style="background: #10b981; color: white;">Search</button>
        </div>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
          <button id="searchSimilarSessionsBtn" class="small">Sessions</button>
          <button id="searchSimilarNodesBtn" class="small">Nodes</button>
          <button id="searchSimilarThreatsBtn" class="small">Threats</button>
          <button id="searchSimilarAttackersBtn" class="small">Attackers</button>
        </div>
        
        <hr style="margin: 0.75rem 0; border: none; border-top: 1px solid var(--border);" />
        
        <div class="small muted">Recent Threat Analyses</div>
        <div id="threatAnalysesList" class="compact-scroll small" style="max-height: 200px; margin-top: 0.5rem;"></div>
      </div>
    </div>
    
    <!-- Reports panel -->
    <div id="reportsCard" class="card">
      <div class="card-header">
        <h2>ğŸ“‹ Forensic Reports</h2>
      </div>
      <div class="card-body">
        <div class="small muted" style="margin-bottom: 0.75rem;">
          Generate and view formal forensic analysis reports for sessions, nodes, and HTTP activity.
        </div>
        
        <div class="small muted">Session Report</div>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
          <input id="reportSessionId" type="number" placeholder="Session ID" style="flex: 1;" />
          <button id="generateReportBtn" style="background: #8b5cf6; color: white;">Generate</button>
        </div>
        
        <hr style="margin: 0.75rem 0; border: none; border-top: 1px solid var(--border);" />
        
        <div class="small muted">Node Report</div>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
          <input id="reportNodeIp" type="text" placeholder="IP Address" style="flex: 1;" />
          <button id="generateNodeReportBtn" style="background: #3b82f6; color: white;">Generate</button>
        </div>
        
        <hr style="margin: 0.75rem 0; border: none; border-top: 1px solid var(--border);" />
        
        <div class="small muted">HTTP Activity Report</div>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
          <input id="reportHttpIp" type="text" placeholder="IP (optional)" style="flex: 1;" />
          <button id="generateHttpReportBtn" style="background: #10b981; color: white;">Generate</button>
        </div>
        
        <hr style="margin: 0.75rem 0; border: none; border-top: 1px solid var(--border);" />
        
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <span class="small muted">Generated Reports</span>
          <button id="refreshReportsBtn" class="small">â†» Refresh</button>
        </div>
        <div id="reportsList" class="compact-scroll small" style="max-height: 200px; margin-top: 0.5rem;">
          <div class="muted">No reports generated yet</div>
        </div>
        
        <hr style="margin: 0.75rem 0; border: none; border-top: 1px solid var(--border);" />
        
        <div class="small muted">Bulk Export</div>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
          <button id="exportAllReportsBtn" class="small" style="background: #6b7280; color: white;">ğŸ“¦ Export All</button>
          <button id="exportRecentReportsBtn" class="small" style="background: #6b7280; color: white;">ğŸ“„ Export Recent (10)</button>
        </div>
      </div>
    </div>
    
  </div>
  
  <!-- Modal container -->
  <div id="modalContainer" class="modal-hidden" aria-hidden="true"></div>
  
  <!-- Toast container -->
  <div id="toast" aria-live="polite"></div>
  
  <!-- App script -->
  <script type="module" src="./static/app.js"></script>
</body>
</html>
